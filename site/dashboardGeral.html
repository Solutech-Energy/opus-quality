<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link rel="stylesheet" href="style.css">
   <link rel="shortcut icon" href="img/logoFavicon.ico" type="image/x-icon">
   <title>Opus | Dashboard Geral</title>
</head>

<body>

   <div class="containerNavbarDashboardGeneral">
      <div class="headerContainerDashboardGeneral">
         <div class="logoContainer">
            <img src="img/imgLogo.png" alt="Logo Opus Quality">
         </div>
         <ul class="navbarLista">
            <a href="index.html" class="loginBtnDashboard">
               <li><b>Logout</b></li>
            </a>
         </ul>
      </div>


      <div class="imgUserDashboardGeneral">
         <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-person-fill"
            viewBox="0 0 16 16">
            <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3Zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
         </svg>
      </div>
   </div>
   <div class="bodyDashboard">
      <div class="leftDash">
         <div class="textCompany">
            <h2>SPtech - 29 De Julho / E2709</h2>
         </div>
         <div class="generalQuality">
            <h4>Qualidade Geral do Prédio</h4>
         </div>
         <div class="cardIndex">
             <div class="leftCard" class="textLeft"><span>Seus índices estão<h2 style="color: green;"> Ótimos</span></h2><span>
             <div><span>Salas irregulares</span><h2 style="color: green;">0</h2></div>
            </div>
             <div class="rightCard">
               <img src="img/imgPositivos.png" alt="" width="70%" height="70%">
             </div>

            <!-- <div class="cardIndex">
               <div class="leftCard" class="textLeft"><span>Seus índices estão<h2 style="color: red;"> Ruins</span></h2><span>
               <div><span>Salas irregulares</span><h2 style="color: red;">5</h2></div>
              </div>
               <div class="rightCard">
                   <img src="img/imgNegativos.png" alt="" width="70%" height="70%"> 
               </div> -->



         </div>
         <div class="horizontalLine"></div>
         <div class="Generalmonitoring">
            <h4>Monitoramento Geral</h4>
         </div>
         <div class="sensors">
            <div class="sensor1">

               <div class="leftGrafico">
               <div class="textPorTemp"><h3>Temperatura</h3></div> 
               <div class="porcTemp"><h1>98%</h1></div>
               </div>

               <div class="rightGrafico">
               <div class="graficoTemp"><canvas id="graficoLDR5"></canvas></div>
               </div>
               </div>
            <div class="sensor2">

            <div class="leftGrafico">
            <div class="textPorLum"><h3>Luminosidade</h3></div>
            <div class="porcLum"><h1>95%</h1></div>
            </div>
            <div class="rightGrafico">
            <div class="graficoLum"><canvas id="graficoLM35"></canvas></div>
            </div>
            </div>
         </div>
      </div>

      <div class="rightDash">
         <div class="textAbsenteeism">
            <h2>Taxa de Absenteísmo Geral</h2>
         </div>
         <div class="absenteeismGraph">
            <canvas id="graficoAbsenteismo"></canvas>
         </div>
         
         <div class="legend">
               <div class="legendGraphic1"></div>
               <div class="legendGraphic2"></div>
               
         </div>

         <div class="overallPercentage">
            <div class="PercentageLeft">
            
            <div class="Percentage1">92%</div>
            <div class="textBottomPercentage1">Presença</div>
            </div>
            <div class="PercentageRight">
            
            <div class="Percentage2">8%</div>
            <div class="textBottomPercentage2">Ausência</div>
           </div>
         </div>
         <div class="textEnvironments">
            <h3>Ambientes</h3>
         </div>


         <div class="environmentisGeneral ">
            <div class="environmentisLine1">
               <div class="environments1">
                  <div class="textEnvironmentsL1"><a href="dashboard.html">Sala Aula 1º Andar</div></a></div>
               <div class="environments1">
                  <div class="textEnvironmentsL1"><a href="dashboard.html">Sala Técnica</div></a></div>
            </div>

            <div class="environmentisLine2 ">
               <div class="environments1">
                  <div class="textEnvironmentsL1"><a href="dashboard.html">Sala Aula 2º Andar</div></a></div>
               <div class="environments1">
                  <div class="textEnvironmentsL1"><a href="dashboard.html">Sala Técnica</div></a></div>
            </div>

            <div class="environmentisLine3 ">
               <div class="environments1">
                  <div class="textEnvironmentsL1"><a href="dashboard.html">Sala Aula 3º Andar</div></a></div>
               <div class="environments1">
                  <div class="textEnvironmentsL1"><a href="dashboard.html">Sala Técnica</div></a></div>
            </div>

            <div class="environmentisLine4 ">
               <div class="environments1">
                  <div class="textEnvironmentsL1"><a href="dashboard.html">Sala Aula 4º Andar</div></a></div>
               <div class="environments1">
                  <div class="textEnvironmentsL1"><a href="dashboard.html">Sala Técnica</div></a></div>
            </div>

            <div class="environmentisLine5 ">
               <div class="environments1">
                  <div class="textEnvironmentsL1"><a href="dashboard.html">Sala Aula 5º Andar</div></a></div>
               <div class="environments1">
                  <div class="textEnvironmentsL1"><a href="dashboard.html">Sala Técnica</div></a></div>
            </div>


         </div>
      </div>

   </div>



    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>


    const ctx = document.getElementById('graficoAbsenteismo');

    const graficoAbsenteismo = new Chart(ctx, {
      type: 'doughnut',
      data: {
        datasets: [
          { backgroundColor: ['#911313','#18630e'],
            data: [8, 92],
            borderWidth: 1
          }]
      },
      options: {
         Plugins: {
      legend: {
         labels: ['Ausência (%)', 'Presença (%) ']
      },
      title: {
         display: false,
      }
    },
    scales: {
      display: false,
    }
  }
});
  



    const ctx1 = document.getElementById('graficoLDR5');

const graficoTemperatura = new Chart(ctx1, {
  type: 'doughnut',
  data: { 
    datasets: [{
      backgroundColor: ['#5220f5','#911313'],
      labels: 'Temperatura (ºC))',
      data: [97, 3],
      borderWidth: 1
    },
]
  },
  options: {
   Plugins: {
      legend: {
        display: false
      },
      title: {
         display: false,
      }
    },
    scales: {
      display: false,
    }
  }
});





const ctx2 = document.getElementById('graficoLM35');

const graficoLuminosidade = new Chart(ctx2, {
  type: 'doughnut',
  data: {

    datasets: [{
      backgroundColor: ['#a39010','#911313'],
      labels: 'Luminosidade (Lux)',
      data: [92, 8],
      borderWidth: 1
    },
    ]
  },
  options: {
   Plugins: {
      legend: {
        display: false
      },
      title: {
         display: false,
      }
    },
    scales: {
      display: false,
    }
  }
});



  
    var paginacao = {};
    var tempo = {};
  
    function obterDados(grafico, endpoint) {
      var http = new XMLHttpRequest();
      http.open('GET', 'http://localhost:3300/sensores/' + endpoint, false);
      http.send(null);
      var valores = JSON.parse(http.responseText);
      if (paginacao[endpoint] == null) {
        paginacao[endpoint] = 0;
      }
      if (tempo[endpoint] == null) {
        tempo[endpoint] = 0;
      }
      // Exibir à partir do último elemento exibido anteriormente
      var ultimaPaginacao = paginacao[endpoint];
      paginacao[endpoint] = valores.length;
      var valores = valores.slice(ultimaPaginacao);
      valores.forEach((valor) => {
        //Máximo de 60 itens exibidos no gráfico
        if (grafico.data.labels.length == 10 && grafico.data.datasets[0].data.length == 10) {
          grafico.data.labels.shift();
          grafico.data.datasets[0].data.shift();
        }
  
        grafico.data.labels.push(tempo[endpoint]++);
        grafico.data.datasets[0].data.push(parseFloat(valor));
        grafico.update();
      })
    }
  
  
  
  
  
  
//     setInterval(() => {

// obterDados(graficoLuminosidade, 'luminosidade');
// obterDados(graficoTemperatura, 'lm35/temperatura');

// }, 2000);


</script>
